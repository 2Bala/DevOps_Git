name: Multi-Environment CI/CD

on:
  push:
    branches:
      - main

jobs:
  build:
    name: Build and Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Install dependencies
        run: npm ci
      - name: Run tests
        run: npm test
      - name: Build application
        run: npm run build

  deploy-to-staging:
    name: Deploy to Staging
    needs: build
    runs-on: ubuntu-latest
    environment: staging
    if: github.ref == 'refs/heads/master'
    steps:
      - name: Deploy to Staging
        run: |
          echo "Deploying to staging environment..."
          # Replace with your actual deployment commands, e.g.,
          # aws s3 sync ./build s3://${{ secrets.S3_BUCKET_NAME }} --delete
          # ssh user@staging.server "deploy-script.sh"

  deploy-to-production:
    name: Deploy to Production
    needs: deploy-to-staging
    runs-on: ubuntu-latest
    environment: production
    if: github.ref == 'refs/heads/master'
    steps:
      - name: Deploy to Production
        run: |
          echo "Deploying to production environment..."
          # Replace with your actual deployment commands, e.g.,
          # aws s3 sync ./build s3://${{ secrets.S3_BUCKET_NAME }} --delete
          # ssh user@production.server "deploy-script.sh"
